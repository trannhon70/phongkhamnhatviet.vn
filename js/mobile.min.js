// let local = 'http://localhost/phongkhamdakhoanhatvietnew.vn';
let local = 'https://phongkhamdakhoanhatviet.vn';

function showSidebar() {
    const sidebar = document.querySelector('.sidebar_mobile');
    const icons_menu = document.querySelector('.header__mobile-top-left-icon');
    const icons_sclose = document.querySelector('.header__mobile-top-left-icon-close');
    sidebar.classList.add('active_mobile');
    sidebar.classList.remove('inactive_mobile');
    icons_menu.style.display = "none";
    icons_sclose.style.display = "block"
}

function hidenSidebar() {
    const sidebar = document.querySelector('.sidebar_mobile');
    const icons_menu = document.querySelector('.header__mobile-top-left-icon');
    const icons_sclose = document.querySelector('.header__mobile-top-left-icon-close');
    sidebar.classList.add('inactive_mobile');
    setTimeout(() => {
        sidebar.classList.remove('active_mobile');
    }, 500);
    icons_menu.style.display = "block";
    icons_sclose.style.display = "none"
}

function formatPhoneNumber(phoneNumber) {
    let cleaned = ('' + phoneNumber).replace(/\D/g, '');
    let match = cleaned.match(/^(\d{4})(\d{3})(\d{3})$/);
    if (match) {
        return '(' + match[1] + ') ' + match[2] + '-' + match[3];
    }
    return null;
}

// slide

const feedbacks1 = document.querySelectorAll('.experienced__bottom-mobile-card');
const listItems1 = document.querySelectorAll('.experienced-item');
let currentIndex1 = 0;

const showFeedback1 = (index) => {
    feedbacks1.forEach((feedback, idx) => {
        feedback.classList.toggle('activeexperienced', idx === index);
    });
    listItems1.forEach((listItem, idx) => {
        listItem.classList.toggle('activeexperienced', idx === index);
    });
};

const handleChangeSlideFeedback1 = () => {
    currentIndex1 = (currentIndex1 + 1) % feedbacks1.length;
    showFeedback1(currentIndex1);
};
showFeedback1(currentIndex1); // Initialize the first feedback as active
setInterval(handleChangeSlideFeedback1, 4000);

//send phone 


function onClickCreatePhone() {
    let sdt = document.getElementById('sdt_mobile').value;
    if (sdt.trim() !== '') {
        if (formatPhoneNumber(sdt)) {
            let baseUrl = window.location.href;
            var xhr = new XMLHttpRequest();
            xhr.open("POST", `${local}/classes/tu_van_ajax.php`, true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    try {
                        let response = JSON.parse(xhr.responseText);
                        if (response.status === 'success') {
                            toastr.success(response.message);
                            document.getElementById('sdt_mobile').value = '';
                        } else {
                            toastr.error(response.message);
                        }
                    } catch (e) {

                        toastr.error("Đã xảy ra lỗi trong quá trình xử lý phản hồi từ máy chủ.");
                    }
                   
                }
            };

            xhr.send("sdt=" + sdt + "&url=" + encodeURIComponent(baseUrl));
        } else {
            toastr.error("Số điện thoại không hợp lệ!");
        }

    } else {
        toastr.error("Số điện thoại không được bỏ trống");

    }
}



//đặt lịch khám mobile 

document.querySelector('button[name="LKMobile"]').addEventListener('click', function(event) {
    event.preventDefault(); // Ngăn chặn hành động mặc định của nút submit

    let form = document.getElementById('form-chatMobile');
    let inputs = form.getElementsByTagName('input');
    let formData = {};

    for (let i = 0; i < inputs.length; i++) {
        let input = inputs[i];
        formData[input.name] = input.value;
    }
    formData['url'] = window.location.href;

    if (formData.giokham !== '' && formData.hoten !== '' && formData.ngaykham !== '' && formData.ngaysinh !== '' && formData.sdt !== '' && formData.trieuchung !== '') {
        if (formatPhoneNumber(formData.sdt)) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", `${local}/classes/khach_hang_ajax.php`, true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {

                    let response = JSON.parse(xhr.responseText);
                    if (response.status === 'success') {
                        toastr.success(response.message);
                        for (let i = 0; i < inputs.length; i++) {
                            let input = inputs[i];
                            input.value = '';
                        }

                    } else {
                        toastr.error(response.message);
                    }
                }
            };

            xhr.send(JSON.stringify(formData));
        } else {
            toastr.error("Số điện thoại không hợp lệ!");
        }

    } else {
        toastr.error("Tất cả các trường không được bỏ trống!");
    }


});

//display none footer goij ngay
let element = document.querySelector('.footer__mobile-container-left-icon-top');

     function hidenIconFooterCall() {
         if (element) {
             element.style.display = 'none'
         }
     }

     function showIconFooterCall() {
         if (element) {
             element.style.display = 'block'
         }
     }

     setInterval(() => {
         hidenIconFooterCall();
         setTimeout(showIconFooterCall, 1500);
     }, 3000);



     function checkImgMobile() {
        let baiVietElement = document.getElementById('bai-viet'); 
        if (!baiVietElement || window.innerWidth > 900) return; 
        let elements = document.querySelectorAll('.glow-on-hover'); 
        let imgElements = baiVietElement.getElementsByTagName('img'); 
        let h2Elements = baiVietElement.getElementsByTagName('h2'); 
        let h3Elements = baiVietElement.getElementsByTagName('h3'); 
        if (elements) { elements.forEach(element => { 
            element.classList.add('glow-on-hover') 
    
            const wrapper = document.createElement('a');
            wrapper.style.display = 'block'; 
            wrapper.style.margin = '10px 0px'; 
            element.parentNode.insertBefore(wrapper, element);
            wrapper.appendChild(element);
        }) }
        Array.from(imgElements).forEach(img => {
            const src = img.getAttribute('src'); 
            if (src && !src.startsWith('/ckfinder/userfiles/images/ICon')) { 
                img.classList.add('img-responsive') 
                
            }
            if (img.src.startsWith(`${local}/ckfinder/userfiles/images/Chat/Chat-Dakhoa.gif`)) { 
                // if (img.src.startsWith('http://localhost/ckfinder/userfiles/images/Chat/Chat-Dakhoa.gif')) { 
                img.classList.add('img-gif'); 
                let divWrapper = document.createElement('p'); 
                img.parentNode.insertBefore(divWrapper, img); 
                divWrapper.appendChild(img) 
            }
        }); 
        Array.from(h2Elements).forEach(h2 => { h2.classList.add('h2-custom') });
        Array.from(h3Elements).forEach(h3 => { h3.classList.add('h3-custom') })
    
       
    }
    
    checkImgMobile()
    document.addEventListener('DOMContentLoaded', checkImgMobile); 
    window.addEventListener('resize', checkImgMobile)