(function() {
    const listImage = document.querySelector('.list_image');
    const imgs = document.querySelectorAll('.list_image img:nth-child(-n+4)');
    const btnLeft = document.querySelector('.btn-left');
    const btnRight = document.querySelector('.btn-right');
    const indicators = document.querySelectorAll('.index-item');
    const length = imgs.length;
    let current = 0;
    let width = imgs[0].offsetWidth;

    // Chuẩn bị cho các thay đổi để trình duyệt tối ưu hóa
    listImage.style.willChange = 'transform';
    
    const updateSlide = () => {
        requestAnimationFrame(() => {
            listImage.style.transform = `translateX(${-width * current}px)`;
            document.querySelector('.active').classList.remove('active');
            indicators[current].classList.add('active');
        });
    };

    const handleChangeSlide = (direction = 1) => {
        current = (current + direction + length) % length;
        updateSlide();
    };

    let handleEventChangeSlide = setInterval(handleChangeSlide, 3000);

    const resetInterval = () => {
        clearInterval(handleEventChangeSlide);
        handleEventChangeSlide = setInterval(handleChangeSlide, 3000);
    };

    btnRight.addEventListener('click', () => {
        handleChangeSlide(1);
        resetInterval();
    });

    btnLeft.addEventListener('click', () => {
        handleChangeSlide(-1);
        resetInterval();
    });

    // Đặt lại chiều rộng mỗi khi cửa sổ thay đổi kích thước để đảm bảo sự chính xác
    window.addEventListener('resize', () => {
        width = imgs[0].offsetWidth;
        updateSlide();
    });
})();
